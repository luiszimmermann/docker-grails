defaults: &defaults
  docker:
    - image: docker:18.06.1-ce
      environment:
        GRAILS_VERSION: 3.3.8
  steps:
    - checkout
    - setup_remote_docker:
        docker_layer_caching: true
    - run:
        name: Build and push Docker image
        command: |
          docker build -t grails:$GRAILS_VERSION --build-arg GRAILS_VERSION=$GRAILS_VERSION .

version: 2
jobs:
  grails-3.3.8:
    <<: *defaults

  grails-2.5.5:
    <<: *defaults
    docker:
        environment:
          GRAILS_VERSION: 2.5.5

workflows:
  version: 2

  build:
    jobs:
      - grails-3.3.8
      - grails-2.5.5